import{R as m,j as u,P as h,S as p,B as v,v as S,x as y,z as g,E as j,F,G as A}from"./index-QyX5GDhd.js";import{C as B}from"./Close-ju7DWMOj.js";import{u as E,h as P}from"./FilterField-DEXnTiCI.js";import{C as b}from"./DataGrid-CVHG_7FI.js";import{u as w}from"./useQuery-Cf13XHXw.js";const z=({header:e="Filters",grouped:s=!0,onChange:a,onClose:o,config:d,children:n,...c})=>{const{activeFilters:t,dispatch:r}=E();let i=0;m.Children.forEach(n,f=>{if(m.isValidElement(f)&&f.props.field&&P(t.find(x=>x.field===f.props.field)))return i++});const l=()=>{r({type:"SET_ACTIVE_FILTERS",payload:[]})};return u.jsx(h,{elevation:0,variant:"outlined",...c,children:u.jsxs(p,{spacing:0,children:[e&&u.jsxs(p,{direction:"row",spacing:0,alignItems:"center",sx:{borderBottom:"1px solid",borderBottomColor:"grey.300",paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1},children:[u.jsxs(p,{direction:"row",spacing:2,flex:1,children:[u.jsx(v,{children:e}),i>0&&u.jsx(b,{label:`${i} active`,color:"primary",size:"small"})]}),u.jsx(S,{variant:"outlined",onClick:l,sx:{marginRight:1},children:"Reset"}),u.jsx(y,{onClick:o,children:u.jsx(B,{})})]}),s&&u.jsx(p,{spacing:0,children:n}),!s&&u.jsx(p,{spacing:2,sx:{padding:2},children:n})]})})},k=(e,s)=>s.split(".").reduce((a,o)=>a==null?void 0:a[o],e),R=(e,s)=>{let a=e;return s&&(a=e.filter(o=>JSON.stringify(o).toLowerCase().indexOf(s.toLowerCase())>-1)),a},q=(e,s,a)=>{let o=e;if(e&&s.length>0){const d={};s.forEach(n=>{if(a){const c=a.find(t=>t.field===n.field);d[n.field]=c==null?void 0:c.operator}}),o=e.filter(n=>{let c=!0;return s.forEach(t=>{let r=!1;if(c===!0){const i=k(n,t.field);switch(d[t.field]){case"contains":{i&&i.indexOf(t.value)>-1&&(r=!0);break}case"contains-one-of":{Array.isArray(t.value)&&t.value.forEach(l=>{r||(Array.isArray(i)?i.indexOf(l)>-1&&(r=!0):i===l&&(r=!0))});break}case"equals-one-of":{Array.isArray(t.value)&&t.value.forEach(l=>{r||i===l&&(r=!0)});break}case"between-inclusive":{if(Array.isArray(t.value)){const l=t.value[0],f=t.value[1];i>=l&&i<=f&&(r=!0)}break}case"between-dates-inclusive":{if(typeof i=="string"&&Array.isArray(t.value)&&t.value[0]&&t.value[1]){const l=g(i);l.isAfter(t.value[0])&&l.isBefore(t.value[1])&&(r=!0)}else r=!0;break}}}r||(c=!1)}),c})}return o},I=(e,s,a,o)=>{const d=R(e,o);return q(d,s,a)},M=e=>{let s=e.queryMode==="server"?j(e.activeFilters,e.filterConfigs):new URLSearchParams;e.staticParams&&Object.keys(e.staticParams).forEach(r=>{e.staticParams&&s.append(r,e.staticParams[r].toString())}),e.queryMode==="server"&&(s.append("limit",e.pageSize.toString()),s.append("offset",e.offset.toString()));const a=e.queryMode==="server"?[e.dataSource,{...e.activeFilters,pageSize:e.pageSize,offset:e.offset}]:[e.dataSource],{isPending:o,isFetching:d,isError:n,data:c,error:t}=w({queryKey:a,queryFn:async()=>{const r=s.toString();let i=e.dataSource;return r&&r.length>0&&(i=`${e.dataSource}?${r}`),await A(i)},placeholderData:F});return{isPending:o,isFetching:d,isError:n,data:c,error:t}};export{z as F,I as f,M as u};
